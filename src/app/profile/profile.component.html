<app-header></app-header>

<div class="container">
  <div class="main-body">

    <!--<nav aria-label="breadcrumb" class="main-breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="index.html">Home</a></li>
        <li class="breadcrumb-item"><a href="javascript:void(0)">User</a></li>
        <li class="breadcrumb-item active" aria-current="page">User Profile</li>
      </ol>
    </nav>-->

    <div class="row gutters-sm">
      <div class="col-md-4 mb-3">
        <div class="card" style="height: 400px">
          <div class="card-body">
            <div class="d-flex flex-column align-items-center text-center">
              <img src="./assets/images/photo.png" alt="User" class="rounded-circle" width="150">
              <div class="mt-3">
                <!--<button [hidden]="!isOwner" [disabled]="requestInProgress" class="text-muted">Editar perfil</button>-->
                <h2 class="text-lg-center">{{user.firstname}} {{user.lastname}}</h2>
                <div>
                  <h3 [hidden]="!isOwner" class="text-info mb-1 inline-block-child">Dinero: ${{user.money}}</h3>
                  <button [hidden]="!isOwner" [disabled]="requestInProgress" class="btn btn-small inline-block-child" (click)="goRequestMoney()">+</button>
                </div>

                <h3 class="text-info font-size-sm">Cantidad de proyectos: {{user.projects.length}}</h3>
                <button [hidden]="!isOwner" [disabled]="requestInProgress" class="btn btn-primary" (click)="goCreateProject()">Crear proyecto</button><br><br>
                <button [hidden]="!isOwner" [disabled]="requestInProgress" class="btn btn-danger" (click)="open(deleteUser)">Eliminar perfil</button>
              </div>
            </div>
          </div>
        </div>
        <div class="card mt-3">
          <ul class="list-group list-group-flush">
            <!--<li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
              <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-globe mr-2 icon-inline"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>Website</h6>
              <span class="text-secondary">https://bootdey.com</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
              <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github mr-2 icon-inline"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>Github</h6>
              <span class="text-secondary">bootdey</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
              <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter mr-2 icon-inline text-info"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>Twitter</h6>
              <span class="text-secondary">@bootdey</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
              <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-instagram mr-2 icon-inline text-danger"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>Instagram</h6>
              <span class="text-secondary">bootdey</span>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center flex-wrap">
              <h6 class="mb-0"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-facebook mr-2 icon-inline text-primary"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg>Facebook</h6>
              <span class="text-secondary">bootdey</span>
            </li>-->
          </ul>
        </div>
      </div>
      <div class="col-md-8">
        <div class="card mb-3" style="height: 400px; font-size: 17px">
          <div class="card-body">
            <div class="row">
              <div class="col-lg-3">
                <h4 class="mb-0">APODO</h4>
              </div>
              <div class="col-sm-9 text-dark">
                {{user.nickname}}
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <h4 class="mb-0">NOMBRE</h4>
              </div>
              <div class="col-sm-9 text-dark">
                {{user.firstname}}
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <h4 class="mb-0">APELLIDO</h4>
              </div>
              <div class="col-sm-9 text-dark">
                {{user.lastname}}
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <h4 class="mb-0">EMAIL</h4>
              </div>
              <div class="col-sm-9 text-dark">
                {{user.email}}
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <h4 class="mb-0">FECHA DE NACIMIENTO</h4>
              </div>
              <div class="col-sm-9 text-dark">
                {{user.birthday}}
              </div>
            </div>
            <hr>
            <div class="row">
              <div class="col-sm-3">
                <h4 class="mb-0">PROVINCIA</h4>
              </div>
              <div class="col-sm-9 text-dark">
                {{user.province}}
              </div>
            </div>
          </div>
        </div>
        <!--<div class="row gutters-sm">
          <div class="col-sm-6 mb-3">
            <div class="card h-100">
              <div class="card-body">
                <h4 class="d-flex align-items-center mb-3"><i class="material-icons text-info mr-2">assignment</i>Proyectos de {{user.nickname}}</h4>
                <img [hidden]="projectsAvailable" src="./assets/images/empty.png" class="center" width="90">
                <ul class="proyectos">
                  <li *ngFor="let project of user.projects">
                    <span routerLink="/project-detail/{{project.id}}">{{project.name}}</span>
                    <ul class="tareas">
                      <li *ngFor="let task of project.tasks">
                        <span routerLink="/task-detail/{{task.id}}">{{task.name}}</span>
                      </li>
                    </ul>
                  </li>
                </ul>
                &lt;!&ndash;<small>Web Design</small>
                <div class="progress mb-3" style="height: 5px">
                  <div class="progress-bar bg-primary" role="progressbar" style="width: 80%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small>Website Markup</small>
                <div class="progress mb-3" style="height: 5px">
                  <div class="progress-bar bg-primary" role="progressbar" style="width: 72%" aria-valuenow="72" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small>One Page</small>
                <div class="progress mb-3" style="height: 5px">
                  <div class="progress-bar bg-primary" role="progressbar" style="width: 89%" aria-valuenow="89" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small>Mobile Template</small>
                <div class="progress mb-3" style="height: 5px">
                  <div class="progress-bar bg-primary" role="progressbar" style="width: 55%" aria-valuenow="55" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small>Backend API</small>
                <div class="progress mb-3" style="height: 5px">
                  <div class="progress-bar bg-primary" role="progressbar" style="width: 66%" aria-valuenow="66" aria-valuemin="0" aria-valuemax="100"></div>
                </div>&ndash;&gt;
              </div>
            </div>
          </div>
          <div class="col-sm-6 mb-3">
            <div class="card h-100">
              <div class="card-body">
                <h4 class="d-flex align-items-center mb-3"><i class="material-icons text-info mr-2">assignment</i>Tareas asignadas a {{user.nickname}}</h4>
                <img [hidden]="tasksAvailable" src="./assets/images/empty.png" class="center" width="90">
                <ul class="tareas">
                  <li *ngFor="let task of assignedTasks">
                    <span routerLink="/task-detail/{{task.id}}">{{task.name}}</span>
                </ul>
                &lt;!&ndash;<small>Web Design</small>
                <div class="progress mb-3" style="height: 5px">
                  <div class="progress-bar bg-primary" role="progressbar" style="width: 80%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small>Website Markup</small>
                <div class="progress mb-3" style="height: 5px">
                  <div class="progress-bar bg-primary" role="progressbar" style="width: 72%" aria-valuenow="72" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small>One Page</small>
                <div class="progress mb-3" style="height: 5px">
                  <div class="progress-bar bg-primary" role="progressbar" style="width: 89%" aria-valuenow="89" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small>Mobile Template</small>
                <div class="progress mb-3" style="height: 5px">
                  <div class="progress-bar bg-primary" role="progressbar" style="width: 55%" aria-valuenow="55" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small>Backend API</small>
                <div class="progress mb-3" style="height: 5px">
                  <div class="progress-bar bg-primary" role="progressbar" style="width: 66%" aria-valuenow="66" aria-valuemin="0" aria-valuemax="100"></div>
                </div>&ndash;&gt;
                &lt;!&ndash;<ul>
                  <li *ngFor="let project of user.projects">
                    <span routerLink="/project-detail/{{project.id}}">{{project.name}}</span>
                    <ul>
                      <li *ngFor="let task of project.tasks">
                        <span routerLink="/task-detail/{{task.id}}">{{task.name}}</span>
                      </li>
                    </ul>
                  </li>
                </ul>&ndash;&gt;
              </div>
            </div>
          </div>
        </div>-->
      </div>
    </div>
    <div class="row">
      <div class="col-12">
      <div class="card">
        <div class="card-body">
          <h4 class="d-flex align-items-center mb-3"><i class="material-icons text-info mr-2">assignment</i>Proyectos de {{user.nickname}}</h4>
          <table class="table table-striped">
            <thead>
            <tr>
              <!--<th scope="col" data-order="desc" data-name="id">ID</th>-->
              <th scope="col" data-order="desc" data-name="name">Nombre</th>
              <th scope="col" data-order="desc" data-name="budget">
                Presupuesto
                <mat-form-field style="height: 1px; width: 1px; background-color: white; border-radius: 4px; margin-bottom: 25px; font-size: 12px; padding-left: 20px">
                  <!--<mat-label>Filtrar por presupuesto</mat-label>-->
                  <mat-select [(ngModel)]="budgetSelected" (valueChange)="setBudgetSelected($event)" style="background-color: white">
                    <mat-option [value]="''">SIN FILTRO</mat-option>
                    <mat-option [value]="'1'">$0 - $1000</mat-option>
                    <mat-option [value]="'2'">$1000 - $50000</mat-option>
                    <mat-option [value]="'3'">$50000 - $150000</mat-option>
                    <mat-option [value]="'4'">Mas de $150000</mat-option>
                  </mat-select>
                </mat-form-field>
              </th>
              <th scope="col" data-order="desc" data-name="tasks">Tareas</th>
              <th scope="col" data-order="desc" data-name="progress">Progreso</th>
              <th scope="col" data-order="desc" data-name="category">
                Categoria
                <mat-form-field style="height: 1px; width: 1px; background-color: white; border-radius: 4px; margin-bottom: 25px; font-size: 12px; padding-left: 20px">
                  <!--<mat-label>Filtrar por categoria</mat-label>-->
                  <mat-select [(ngModel)]="categorySelected" (valueChange)="setCategorySelected($event)" style="background-color: white">
                    <mat-option [value]="''">SIN FILTRO</mat-option>
                    <mat-option [value]="category" *ngFor="let category of categories">{{category}}</mat-option>
                  </mat-select>
                </mat-form-field>
              </th>
              <th scope="col" class="col-tretch"></th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let project of $projectValues
              |async |slice:((projectPaginator.pageIndex)*projectPaginator.pageSize):((projectPaginator.pageIndex+1)*projectPaginator.pageSize)">
              <!--<th>{{ project.id }}</th>-->
              <th><a class="hover" routerLink="/project-detail/{{project.id}}">{{ project.name }}</a></th>
              <td>$ {{ project.budget }}</td>
              <td>
                <select [disabled]="project.tasks.length == 0" name="tasks" id="tasks" style="width: 100px">
                  <option disabled selected>Cantidad: {{project.tasks.length}}</option>
                  <option *ngFor="let task of project.tasks"
                          [value]="task.name"
                          routerLink="/task-detail/{{task.id}}">
                    {{task.name}}
                  </option>
                  <!--<option value="volvo">Volvo</option>
                  <option value="saab">Saab</option>
                  <option value="mercedes">Esto es un texto mas largo de lo usual, solo para probar</option>
                  <option value="audi">Audi</option>-->
                </select>
              </td>
              <td>
                <div>
                  <div class="progress mb-3" style="height: 20px; background-color: burlywood; border-radius: 5px">
                    <div class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" [style.width.%]="project.percentage"></div>
                    <!--<div style="padding-top: 10px;">{{project.percentage}}%</div>-->
                  </div>
                </div>
              </td>
              <td>{{ project.category }}</td>
            </tr>
            </tbody>
          </table>
          <mat-paginator style="color: black; font-size: 10px; background: transparent; box-sizing: border-box;"
                         [showFirstLastButtons]="true" #projectPaginator
                         [length]="projectsLength"
                         [pageSizeOptions]="[3, 5, 10]"
                         (page)="projectPageEvent = $event">
          </mat-paginator>
        </div>
      </div>
    </div>
    </div><br><br>
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <h4 class="d-flex align-items-center mb-3"><i class="material-icons text-info mr-2">assignment</i>Tareas asignadas a {{user.nickname}}</h4>
            <table class="table table-striped">
              <thead>
              <tr>
                <!--<th scope="col" data-order="desc" data-name="id">ID</th>-->
                <th scope="col" data-order="desc" data-name="name">Nombre</th>
                <th scope="col" data-order="desc" data-name="budget">
                  Recompensa
                  <mat-form-field style="height:1px; width: 1px; background-color: white; border-radius: 4px; padding: 5px; font-size: 12px;">
                    <!--<mat-label>Buscar por recompensa</mat-label>-->
                    <mat-select [(ngModel)]="rewardSelected" (valueChange)="setRewardSelected($event)" style="background-color: white">
                      <mat-option [value]="''">SIN FILTRO</mat-option>
                      <mat-option [value]="'1'">$0 - $100</mat-option>
                      <mat-option [value]="'2'">$100 - $500</mat-option>
                      <mat-option [value]="'3'">$500 - $1000</mat-option>
                      <mat-option [value]="'4'">$1000 - $5000</mat-option>
                      <mat-option [value]="'5'">$5000 - $10000</mat-option>
                      <mat-option [value]="'6'">Mas de $10000</mat-option>
                    </mat-select>
                  </mat-form-field>
                </th>
                <th scope="col" data-order="desc" data-name="state">
                  Estado
                  <mat-form-field style="height:1px; width:1px; background-color: white; border-radius: 4px; padding: 5px; font-size: 12px;">
                    <!--<mat-label>Buscar por estado</mat-label>-->
                    <mat-select [(ngModel)]="stateSelected" (valueChange)="setStateSelected($event)" style="background-color: white">
                      <mat-option [value]="''">SIN FILTRO</mat-option>
                      <mat-option [value]="state" *ngFor="let state of states">{{state}}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </th>
                <th scope="col" data-order="desc" data-name="difficulty">
                  Dificultad
                  <mat-form-field style="height:1px; width:1px; background-color: white; border-radius: 4px; padding: 5px; font-size: 12px;">
                    <!--<mat-label>Buscar por dificultad</mat-label>-->
                    <mat-select [(ngModel)]="difficultySelected" (valueChange)="setDifficultySelected($event)" style="background-color: white">
                      <mat-option [value]="''">SIN FILTRO</mat-option>
                      <mat-option [value]="difficulty" *ngFor="let difficulty of difficulties">{{difficulty}}</mat-option>
                    </mat-select>
                  </mat-form-field>
                </th>
                <th scope="col" data-order="desc" data-name="owner">Administrador</th>
                <th scope="col" class="col-tretch"></th>
              </tr>
              </thead>
              <tbody>
              <tr *ngFor="let task of $tasksValues
                |async |slice:((assignedTasksPaginator.pageIndex)*assignedTasksPaginator.pageSize):((assignedTasksPaginator.pageIndex+1)*assignedTasksPaginator.pageSize)">
                <!--<th>{{ task.id }}</th>-->
                <th><a class="hover" routerLink="/task-detail/{{task.id}}">{{ task.name }}</a></th>
                <td>$ {{ task.reward }}</td>
                <td>{{ task.state }}</td>
                <td>{{ task.difficulty }}</td>
                <td>{{ task.owner }}</td>
              </tr>
              </tbody>
            </table>
            <mat-paginator style="color: black; font-size: 10px; background: transparent; box-sizing: border-box;"
                           [showFirstLastButtons]="true" #assignedTasksPaginator
                           [length]="tasksLength"
                           [pageSizeOptions]="[3, 5, 10]"
                           (page)="tasksPageEvent = $event">
            </mat-paginator>
          </div>
        </div>
      </div>
    </div>
  </div>

  <mat-progress-spinner
    [hidden]="!requestInProgress"
    class="example-margin"
    mode="indeterminate">
  </mat-progress-spinner>

</div>

<ng-template #deleteUser let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-delete-user">¿Esta seguro de que desea eliminar su perfil?</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cerrar')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <!--<div class="modal-body">
    <form>
      <div class="form-group">
        <label for="dateOfBirth">Date of birth</label>
        <div class="input-group">
          <input id="dateOfBirth" class="form-control" placeholder="yyyy-mm-dd" name="dp" ngbDatepicker #dp="ngbDatepicker">
          <div class="input-group-append">
            <button class="btn btn-outline-secondary calendar" (click)="dp.toggle()" type="button"></button>
          </div>
        </div>
      </div>
    </form>
  </div>-->
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-danger" (click)=delete(user.nickname)>Eliminar mi perfil</button>
    <button type="button" class="btn btn-outline-dark" (click)="modal.close('Cancelar')">Cancelar</button>
  </div>
</ng-template>
